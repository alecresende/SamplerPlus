//
// samples is an array of samples with each element having a Tags, Title, and Path field
// name is simply the name of the folder

function Folder(name, samples) {
	
	this.name = name;
	this.samples = samples;
}

function SamplePointer(Title, Tags, Path) {
	this.Title = Title;
	this.Tags = Tags;
	this.Path = Path;
}


function folders() {
	browseFolders();	

}

function newFolder() {
	var folderName = prompt("What should we call this new folder?");
	
	document.body.innerHTML = "";
	
	var listWidget = $("<ol>").attr({"id" : "selectable"});
	
	$.getJSON('browseJSON', function (data) {
			$.each(data,
				   function (i) {
					   var ul = $("<ul>").text(data[i].Title + " (" + data[i].Tags + ")");
					   ul.attr({"class" : "ui-widget-content",
								   "name" : data[i].Title,
								   "tags" : data[i].Tags,
								   "path" : data[i].Path
								   });
					   
					   
					   listWidget.append(ul);
				   })
		});
	
	var folderContents = null;
	listWidget.selectable();
	listWidget.on("selectableselected", function (event, ui) {
			folderContents = $(".ui-selected");
			console.log($(".ui-selected"));
		});
	
	var image = $('<img src=\"add-icon.png\"\\>').load(function() {
			$(this).width(30).height(30).prependTo(name);
		});

	
	image.click(function () {
			if(folderContents) {
				var formdata = new FormData();
				var i = 0;
				var list = "";
				var mapped = $.map(folderContents, function (x) {
					
					console.log(x);
					if (list=="")
						list = $(x).attr("path");
					else
						list+=";"+($(x).attr("path"));
					i++;
					return $(x);
					//return {"name" : $(x).attr("name"), "tags" : $(x).attr("tags"), "path" :  $(x).attr("path")};
				});
				
				var folderObj = new Folder(folderName, mapped);
				
				var formdata = new FormData();
				formdata.append("name", folderName);
				formdata.append("list", list);

				$.ajax({
						url: 'newFolder',
							data: formdata,
							cache: false,
							contentType: false,
							processData: false,
							type: 'POST',
							success: function(data){
							console.log("SUCESS");
						}
					});
				console.log("SHOULDVE SENT IT BY NOW");
					
			}
		});
	$("body").append(image);
	$("body").append($("<br>"));
	$("body").append(listWidget);

	// should look up a list of all the samples and allow the user to choose which ones should be added
}

setTimeout(function () {
		$("img.folders").click( function() {
				folders();
			});
		
		$("img.new-folder").click( function () {
				newFolder();
			});
		
		console.log("Folder functions set up");
	}, 1000);
